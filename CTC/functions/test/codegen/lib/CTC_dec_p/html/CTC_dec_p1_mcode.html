<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1U3">u_hat</span> ] = CTC_dec_p(<span class="var type1" id="S3T2U6">r</span>, <span class="var type1" id="S4T3U7">state_update_table</span>, <span class="var type1" id="S5T3U8">output_table</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line">             <span class="var type1" id="S6T3U9">neighbours_table</span>, <span class="var type1" id="S7T4U10">modulation_table</span>, <span class="var type1" id="S8T5U11">sigma_w</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line">             <span class="var type1" id="S9T5U12">N</span>, <span class="var type1" id="S10T5U13">n_it</span>, <span class="var type1" id="S11T6U14">p_input_table</span>, <span class="var type1" id="S12T6U15">p_step_table</span>, <span class="var type1" id="S13T2U16">puncturing_pattern</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% CTC_DECODER: Basic CTC decoding through message passing </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    <span class="comment">% CRSC code component params</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    <span class="comment">%crsc_k = size(CRSC.P,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    <span class="comment">%crsc_n = size(CRSC.P,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">    <span class="comment">%crsc_v = length(CRSC.G);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">    <span class="mxinfo " id="T5:U13"><span class="var type1" id="S14T5U19">crsc_k</span> = <span class="mxinfo " id="T5:U15">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">    <span class="mxinfo " id="T5:U16"><span class="var type1" id="S15T5U23">crsc_n</span> = <span class="mxinfo " id="T5:U18">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">    <span class="mxinfo " id="T5:U19"><span class="var type1" id="S16T5U27">crsc_v</span> = <span class="mxinfo " id="T5:U21">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%   piece_const = log(1+exp(-(0:5)));% TO IMPLEMENT AND SEE THE DIFFERENCE!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">    <span class="comment">% De-puncturing of the received sequence in a N x (2n-k) matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">    <span class="mxinfo " id="T7:U22"><span class="var type1" id="S17T7U31">r_dep</span> = <span class="mxinfo " id="T7:U24">zeros(<span class="var type1" id="S9T5U34">N</span>, <span class="mxinfo " id="T5:U26">2*<span class="var type1" id="S15T5U38">crsc_n</span>-<span class="var type1" id="S14T5U39">crsc_k</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">    <span class="mxinfo " id="T5:U29"><span class="var type1" id="S19T5U42">index_r</span> = <span class="mxinfo " id="T5:U31">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">    <span class="mxinfo " id="T5:U32"><span class="var type1" id="S20T5U46">index_p</span> = <span class="mxinfo " id="T5:U34">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S21T5U50">i</span> = <span class="mxinfo " id="T5:U36">0</span> : <span class="mxinfo " id="T5:U37"><span class="var type1" id="S9T5U54">N</span> -<span class="mxinfo " id="T5:U39">1</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">         <span class="keyword">for</span> <span class="var type1" id="S22T5U58">j</span> = <span class="mxinfo " id="T5:U41">0</span> : 2*<span class="var type1" id="S15T5U65">crsc_n</span>-<span class="var type1" id="S14T5U66">crsc_k</span>-1</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T8:U44"><span class="mxinfo " id="T5:U45"><span class="var type1" id="S13T2U73">puncturing_pattern</span>(<span class="mxinfo " id="T5:U47"><span class="var type1" id="S20T5U75">index_p</span>+<span class="mxinfo " id="T5:U49">1</span></span>)</span> == <span class="mxinfo " id="T5:U50">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">                 <span class="mxinfo " id="T5:U51"><span class="mxinfo " id="T5:U52"><span class="var type1" id="S17T7U81">r_dep</span>(<span class="mxinfo " id="T5:U54"><span class="var type1" id="S21T5U83">i</span>+<span class="mxinfo " id="T5:U56">1</span></span>, <span class="mxinfo " id="T5:U57"><span class="var type1" id="S22T5U86">j</span>+<span class="mxinfo " id="T5:U59">1</span></span>)</span> = <span class="mxinfo " id="T5:U60"><span class="var type1" id="S3T2U89">r</span>(<span class="mxinfo " id="T5:U62"><span class="var type1" id="S19T5U91">index_r</span>+<span class="mxinfo " id="T5:U64">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">                 <span class="mxinfo " id="T5:U65"><span class="var type1" id="S19T5U95">index_r</span> = <span class="mxinfo " id="T5:U67"><span class="var type1" id="S19T5U97">index_r</span> + <span class="mxinfo " id="T5:U69">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">                 <span class="mxinfo " id="T5:U70"><span class="mxinfo " id="T5:U71"><span class="var type1" id="S17T7U103">r_dep</span>(<span class="mxinfo " id="T5:U73"><span class="var type1" id="S21T5U105">i</span>+<span class="mxinfo " id="T5:U75">1</span></span>, <span class="mxinfo " id="T5:U76"><span class="var type1" id="S22T5U108">j</span>+<span class="mxinfo " id="T5:U78">1</span></span>)</span> = <span class="mxinfo " id="T5:U79">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">            <span class="mxinfo " id="T5:U80"><span class="var type1" id="S20T5U113">index_p</span> = <span class="mxinfo " id="T5:U82"><span class="var type1" id="S20T5U115">index_p</span> + <span class="mxinfo " id="T5:U84">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line">         <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">    <span class="comment">% MESSAGE PASSING DECODING ALGORITHM</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">    <span class="comment">% 1. INITIALIZATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">    <span class="comment">% 1.1 The q vector is initialized to the a priori probability,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">    <span class="mxinfo " id="T9:U85"><span class="var type1" id="S23T9U119">q</span> = <span class="mxinfo " id="T9:U87">log(<span class="mxinfo " id="T9:U88"><span class="mxinfo " id="T9:U89">ones(<span class="mxinfo " id="T10:U90">2^<span class="var type1" id="S14T5U127">crsc_k</span></span>, <span class="var type1" id="S9T5U128">N</span>)</span>./(<span class="mxinfo " id="T5:U93">2^<span class="var type1" id="S14T5U132">crsc_k</span></span>)</span>)</span></span>; <span class="comment">% Row: input  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">    <span class="mxinfo " id="T9:U95"><span class="var type1" id="S23T9U135">q</span> = <span class="mxinfo " id="T9:U97">bsxfun(@minus, <span class="var type1" id="S23T9U140">q</span>, <span class="mxinfo " id="T11:U99">max(<span class="var type1" id="S23T9U143">q</span>)</span>)</span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">    <span class="comment">% 1.2 Two g vectors: g1 for the upper code and g2 for the lower one</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">    <span class="mxinfo " id="T12:U101"><span class="var type1" id="S29T12U146">g1</span> = <span class="mxinfo " id="T12:U103">zeros(<span class="mxinfo " id="T5:U104">2^<span class="var type1" id="S15T5U151">crsc_n</span></span>, <span class="var type1" id="S9T5U152">N</span>)</span></span>;      <span class="comment">% Row: output | Column: step l in blocks</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo " id="T12:U107"><span class="var type1" id="S30T12U155">g2</span> = <span class="mxinfo " id="T12:U109">zeros(<span class="mxinfo " id="T5:U110">2^<span class="var type1" id="S15T5U160">crsc_n</span></span>, <span class="var type1" id="S9T5U161">N</span>)</span></span>;      <span class="comment">% Row: output | Column: step l in blocks   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    <span class="comment">% To compute g2 we use must rebuild the part due to the lower encoder</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="comment">% using the inverse of the permutation matrix P^-1 = P^T</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo " id="T13:U113"><span class="var type1" id="S31T13U164">r1</span> = <span class="mxinfo " id="T13:U115"><span class="var type1" id="S17T7U166">r_dep</span>(<span class="mxinfo " id="T14:U117">:</span>,<span class="mxinfo " id="T15:U118">1:<span class="var type1" id="S15T5U170">crsc_n</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">    <span class="comment">%r2 = [reshape(P*(reshape(r_dep(:,[1,2]).', 1,[]).'),2,[]).',r_dep(:, crsc_n+1:end)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">    <span class="mxinfo " id="T1:U120"><span class="var type1" id="S32T1U173">r2</span> = <span class="mxinfo " id="T1:U122"><span class="var type1" id="S17T7U175">r_dep</span>(<span class="mxinfo " id="T14:U124">:</span>, <span class="mxinfo " id="T10:U125"><span class="var type1" id="S15T5U179">crsc_n</span>+1:end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S34T5U185">l</span> = <span class="mxinfo " id="T5:U128">0</span> : <span class="mxinfo " id="T5:U129"><span class="var type1" id="S9T5U189">N</span> - <span class="mxinfo " id="T5:U131">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">        <span class="keyword">for</span>  <span class="var type1" id="S35T5U193">y</span> = <span class="mxinfo " id="T5:U133">0</span> : 2^<span class="var type1" id="S15T5U199">crsc_n</span> - 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">           <span class="mxinfo " id="T16:U135"><span class="var type1" id="S36T16U203">mod_y</span> = <span class="mxinfo " id="T16:U137"><span class="mxinfo " id="T16:U138"><span class="var type1" id="S7T4U206">modulation_table</span>(<span class="mxinfo " id="T5:U140"><span class="var type1" id="S35T5U208">y</span>+<span class="mxinfo " id="T5:U142">1</span></span>,<span class="mxinfo " id="T15:U143">:</span>)</span>.*<span class="mxinfo " id="T16:U144"><span class="mxinfo " id="T17:U145"><span class="var type1" id="S13T2U213">puncturing_pattern</span>(<span class="mxinfo " id="T17:U147"><span class="mxinfo " id="T5:U148"><span class="mxinfo " id="T5:U149"><span class="var type1" id="S34T5U217">l</span>*(<span class="mxinfo " id="T5:U151"><span class="mxinfo " id="T5:U152"><span class="mxinfo " id="T5:U153">2</span>*<span class="var type1" id="S15T5U222">crsc_n</span></span>-<span class="var type1" id="S14T5U223">crsc_k</span></span>)</span>+1</span>:<span class="mxinfo " id="T5:U156"><span class="var type1" id="S34T5U227">l</span>*(2*<span class="var type1" id="S15T5U232">crsc_n</span>-<span class="var type1" id="S14T5U233">crsc_k</span>)+<span class="var type1" id="S15T5U234">crsc_n</span></span></span>)</span>.'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">            <span class="mxinfo " id="T5:U161"><span class="mxinfo " id="T5:U162"><span class="var type1" id="S29T12U238">g1</span>(<span class="mxinfo " id="T5:U164"><span class="var type1" id="S35T5U240">y</span>+<span class="mxinfo " id="T5:U166">1</span></span>, <span class="mxinfo " id="T5:U167"><span class="var type1" id="S34T5U243">l</span>+<span class="mxinfo " id="T5:U169">1</span></span>)</span> = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">                    <span class="mxinfo " id="T5:U170">sum(<span class="mxinfo " id="T16:U171"><span class="mxinfo " id="T16:U172">abs(<span class="mxinfo " id="T16:U173"><span class="mxinfo " id="T16:U174"><span class="var type1" id="S31T13U252">r1</span>(<span class="mxinfo " id="T5:U176"><span class="var type1" id="S34T5U254">l</span>+<span class="mxinfo " id="T5:U178">1</span></span>,<span class="mxinfo " id="T15:U179">:</span>)</span> - <span class="var type1" id="S36T16U257">mod_y</span></span>)</span>.^2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">            <span class="mxinfo " id="T5:U181"><span class="mxinfo " id="T5:U182"><span class="var type1" id="S30T12U262">g2</span>(<span class="mxinfo " id="T5:U184"><span class="var type1" id="S35T5U264">y</span>+<span class="mxinfo " id="T5:U186">1</span></span>, <span class="mxinfo " id="T5:U187"><span class="var type1" id="S34T5U267">l</span>+<span class="mxinfo " id="T5:U189">1</span></span>)</span> = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">                    <span class="mxinfo " id="T5:U190">sum(<span class="mxinfo " id="T5:U191"><span class="mxinfo " id="T5:U192">abs(<span class="mxinfo " id="T5:U193"><span class="mxinfo " id="T5:U194"><span class="var type1" id="S32T1U276">r2</span>(<span class="mxinfo " id="T5:U196"><span class="var type1" id="S34T5U278">l</span>+<span class="mxinfo " id="T5:U198">1</span></span>,<span class="mxinfo " id="T10:U199">:</span>)</span> - <span class="mxinfo " id="T5:U200"><span class="var type1" id="S36T16U282">mod_y</span>(<span class="mxinfo " id="T5:U202"><span class="var type1" id="S14T5U285">crsc_k</span>+1:<span class="var type1" id="S15T5U287">crsc_n</span></span>)</span></span>)</span>.^2</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T12:U205"><span class="var type1" id="S29T12U291">g1</span> = <span class="mxinfo " id="T12:U207"><span class="mxinfo " id="T5:U208"><span class="mxinfo " id="T5:U209">-1</span>/(<span class="mxinfo " id="T5:U210"><span class="mxinfo " id="T5:U211">2</span>*<span class="mxinfo " id="T5:U212"><span class="var type1" id="S8T5U300">sigma_w</span>^2</span></span>)</span>.*<span class="var type1" id="S29T12U302">g1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo " id="T12:U215"><span class="var type1" id="S30T12U305">g2</span> = <span class="mxinfo " id="T12:U217"><span class="mxinfo " id="T5:U218"><span class="mxinfo " id="T5:U219">-1</span>/(<span class="mxinfo " id="T5:U220"><span class="mxinfo " id="T5:U221">2</span>*<span class="mxinfo " id="T5:U222"><span class="var type1" id="S8T5U314">sigma_w</span>^2</span></span>)</span>.*<span class="var type1" id="S30T12U316">g2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">    <span class="mxinfo " id="T12:U225"><span class="var type1" id="S29T12U319">g1</span> = <span class="mxinfo " id="T12:U227">bsxfun(@minus, <span class="var type1" id="S29T12U324">g1</span>, <span class="mxinfo " id="T11:U229">max(<span class="var type1" id="S29T12U327">g1</span>)</span>)</span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T12:U231"><span class="var type1" id="S30T12U330">g2</span> = <span class="mxinfo " id="T12:U233">bsxfun(@minus, <span class="var type1" id="S30T12U335">g2</span>, <span class="mxinfo " id="T11:U235">max(<span class="var type1" id="S30T12U338">g2</span>)</span>)</span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T9:U237"><span class="var type1" id="S39T9U341">E2</span> = <span class="mxinfo " id="T9:U239">zeros(<span class="mxinfo " id="T5:U240">2^<span class="var type1" id="S14T5U346">crsc_k</span></span>, <span class="var type1" id="S9T5U347">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">    <span class="mxinfo " id="T9:U243"><span class="var type1" id="S40T9U350">E1</span> = <span class="mxinfo " id="T9:U245">zeros(<span class="mxinfo " id="T5:U246">2^<span class="var type1" id="S14T5U355">crsc_k</span></span>, <span class="var type1" id="S9T5U356">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S41T5U359">cont</span> = <span class="mxinfo " id="T5:U250">1</span> : <span class="var type1" id="S10T5U362">n_it</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">        <span class="comment">% 2 BCJR ALGORITHM ON THE UPPER CODE</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">        <span class="comment">% 2.0 BCJR initialization </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">        <span class="mxinfo " id="T12:U252"><span class="var type1" id="S42T12U365">backward_matrix</span> = <span class="mxinfo " id="T12:U254">-<span class="mxinfo " id="T12:U255">Inf(<span class="mxinfo " id="T10:U256">2^<span class="var type1" id="S16T5U371">crsc_v</span></span>, <span class="var type1" id="S9T5U372">N</span>)</span></span></span>;   <span class="comment">% Row: state  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">        <span class="mxinfo " id="T12:U259"><span class="var type1" id="S44T12U375">forward_matrix</span> = <span class="mxinfo " id="T12:U261">-<span class="mxinfo " id="T12:U262">Inf(<span class="mxinfo " id="T5:U263">2^<span class="var type1" id="S16T5U381">crsc_v</span></span>, <span class="var type1" id="S9T5U382">N</span>)</span></span></span>;    <span class="comment">% Row: state  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">        <span class="mxinfo " id="T9:U266"><span class="var type1" id="S45T9U385">extrinsic_matrix</span> = <span class="mxinfo " id="T9:U268">-<span class="mxinfo " id="T9:U269">Inf(<span class="mxinfo " id="T5:U270">2^<span class="var type1" id="S14T5U391">crsc_k</span></span>, <span class="var type1" id="S9T5U392">N</span>)</span></span></span>;  <span class="comment">% Row: input  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">        <span class="mxinfo " id="T9:U273"><span class="var type1" id="S46T9U395">mu_eq</span> = <span class="mxinfo " id="T9:U275"><span class="var type1" id="S39T9U397">E2</span> + <span class="var type1" id="S23T9U398">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">        <span class="mxinfo " id="T9:U278"><span class="var type1" id="S46T9U401">mu_eq</span> = <span class="mxinfo " id="T9:U280">bsxfun(@minus, <span class="var type1" id="S46T9U406">mu_eq</span>, <span class="mxinfo " id="T11:U282">max(<span class="var type1" id="S46T9U409">mu_eq</span>)</span>)</span></span>;  <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">        <span class="comment">% 2.1 Backward messages update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">        <span class="mxinfo " id="T5:U284"><span class="mxinfo " id="T5:U285"><span class="var type1" id="S42T12U413">backward_matrix</span>(<span class="mxinfo " id="T5:U287">1</span>,<span class="mxinfo " id="T5:U288">end</span>)</span> = <span class="mxinfo " id="T5:U289">0</span></span>; <span class="comment">% Starting with B_(N-1)(s_0) = 0 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U420">l</span> = <span class="mxinfo " id="T5:U291"><span class="mxinfo " id="T5:U292"><span class="mxinfo " id="T5:U293">2</span>*<span class="var type1" id="S9T5U426">N</span></span>-<span class="mxinfo " id="T5:U295">1</span></span> : <span class="mxinfo " id="T5:U296">-1</span> : <span class="mxinfo " id="T5:U297">1</span>      <span class="comment">% This is a matlab matrix index</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">            <span class="mxinfo " id="T5:U298"><span class="var type1" id="S47T5U433">index</span> = <span class="mxinfo " id="T5:U300">mod(<span class="var type1" id="S34T5U436">l</span>,<span class="var type1" id="S9T5U437">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S49T5U440">s</span> = <span class="mxinfo " id="T5:U304">0</span> : 2^<span class="var type1" id="S16T5U446">crsc_v</span> - 1  <span class="comment">% s_l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">                <span class="mxinfo " id="T5:U306"><span class="var type1" id="S50T5U450">summ</span> = <span class="mxinfo " id="T5:U308">-<span class="mxinfo " id="T5:U309">Inf</span></span></span>;       <span class="comment">% Sum over u </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S51T5U456">u</span> = <span class="mxinfo " id="T5:U311">0</span> : 2^<span class="var type1" id="S14T5U462">crsc_k</span> - 1 </span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">                    <span class="mxinfo " id="T5:U313"><span class="var type1" id="S52T5U466">ql_u</span> = <span class="mxinfo " id="T5:U315"><span class="var type1" id="S46T9U468">mu_eq</span>(<span class="mxinfo " id="T5:U317"><span class="var type1" id="S51T5U470">u</span>+<span class="mxinfo " id="T5:U319">1</span></span>, <span class="mxinfo " id="T5:U320"><span class="var type1" id="S47T5U473">index</span>+<span class="mxinfo " id="T5:U322">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">                    <span class="mxinfo " id="T5:U323"><span class="var type1" id="S35T5U477">y</span> = <span class="mxinfo " id="T5:U325"><span class="var type1" id="S5T3U479">output_table</span>(<span class="mxinfo " id="T5:U327"><span class="var type1" id="S49T5U481">s</span>+<span class="mxinfo " id="T5:U329">1</span></span>, <span class="mxinfo " id="T5:U330"><span class="var type1" id="S51T5U484">u</span>+<span class="mxinfo " id="T5:U332">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">                    <span class="mxinfo " id="T5:U333"><span class="var type1" id="S53T5U488">gl_y</span> = <span class="mxinfo " id="T5:U335"><span class="var type1" id="S29T12U490">g1</span>(<span class="mxinfo " id="T5:U337"><span class="var type1" id="S35T5U492">y</span>+<span class="mxinfo " id="T5:U339">1</span></span>, <span class="mxinfo " id="T5:U340"><span class="var type1" id="S47T5U495">index</span>+<span class="mxinfo " id="T5:U342">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">                    <span class="mxinfo " id="T5:U343"><span class="var type1" id="S54T5U499">s_n</span>  = <span class="mxinfo " id="T5:U345"><span class="var type1" id="S4T3U501">state_update_table</span>(<span class="mxinfo " id="T5:U347"><span class="var type1" id="S49T5U503">s</span>+<span class="mxinfo " id="T5:U349">1</span></span>, <span class="mxinfo " id="T5:U350"><span class="var type1" id="S51T5U506">u</span>+<span class="mxinfo " id="T5:U352">1</span></span>)</span></span>;    <span class="comment">% s_(l+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">                    <span class="mxinfo " id="T5:U353"><span class="var type1" id="S55T5U510">B_n</span> = <span class="mxinfo " id="T5:U355"><span class="var type1" id="S42T12U512">backward_matrix</span>(<span class="mxinfo " id="T5:U357"><span class="var type1" id="S54T5U514">s_n</span>+<span class="mxinfo " id="T5:U359">1</span></span>, <span class="mxinfo " id="T5:U360"><span class="var type1" id="S47T5U517">index</span>+<span class="mxinfo " id="T5:U362">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">                    <span class="mxinfo " id="T5:U363"><span class="var type1" id="S56T5U521">add</span> = <span class="mxinfo " id="T5:U365"><span class="mxinfo " id="T5:U366"><span class="var type1" id="S55T5U524">B_n</span> + <span class="var type1" id="S53T5U525">gl_y</span></span> + <span class="var type1" id="S52T5U526">ql_u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">                    <span class="mxinfo " id="T5:U370"><span class="var type1" id="S50T5U529">summ</span> = <span class="mxinfo " id="T5:U372">log(<span class="mxinfo " id="T5:U373"><span class="mxinfo " id="T5:U374">exp(<span class="var type1" id="S50T5U535">summ</span>)</span>+<span class="mxinfo " id="T5:U376">exp(<span class="var type1" id="S56T5U538">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U378"><span class="var type1" id="S47T5U542">index</span> == <span class="mxinfo " id="T5:U380">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">                    <span class="mxinfo " id="T5:U381"><span class="var type1" id="S58T5U546">index2</span> = <span class="var type1" id="S9T5U547">N</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">                    <span class="mxinfo " id="T5:U384"><span class="var type1" id="S58T5U551">index2</span> = <span class="var type1" id="S47T5U552">index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">                <span class="mxinfo " id="T5:U387"><span class="mxinfo " id="T5:U388"><span class="var type1" id="S42T12U556">backward_matrix</span>(<span class="mxinfo " id="T5:U390"><span class="var type1" id="S49T5U558">s</span>+<span class="mxinfo " id="T5:U392">1</span></span>, <span class="var type1" id="S58T5U560">index2</span>)</span> = <span class="var type1" id="S50T5U561">summ</span></span>;           </span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">           <span class="mxinfo " id="T18:U395"><span class="mxinfo " id="T18:U396"><span class="var type1" id="S42T12U565">backward_matrix</span>(<span class="mxinfo " id="T19:U398">:</span>, <span class="var type1" id="S58T5U567">index2</span>)</span> = <span class="mxinfo " id="T18:U400"><span class="mxinfo " id="T18:U401"><span class="var type1" id="S42T12U570">backward_matrix</span>(<span class="mxinfo " id="T19:U403">:</span>, <span class="var type1" id="S58T5U572">index2</span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">                         - <span class="mxinfo " id="T5:U405">max(<span class="mxinfo " id="T18:U406"><span class="var type1" id="S42T12U576">backward_matrix</span>(<span class="mxinfo " id="T19:U408">:</span>, <span class="var type1" id="S58T5U578">index2</span>)</span>)</span></span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">        <span class="comment">% 2.2 Forward messages update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">        <span class="mxinfo " id="T5:U410"><span class="mxinfo " id="T5:U411"><span class="var type1" id="S44T12U582">forward_matrix</span>(<span class="mxinfo " id="T5:U413">1</span>,<span class="mxinfo " id="T5:U414">1</span>)</span> = <span class="mxinfo " id="T5:U415">0</span></span>; <span class="comment">% Starting with F_0 (s_0) = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U588">l</span> = <span class="mxinfo " id="T5:U417">2</span>:<span class="mxinfo " id="T5:U418"><span class="mxinfo " id="T5:U419">2</span>*<span class="var type1" id="S9T5U593">N</span></span>            <span class="comment">% This is a matlab matrix index</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">            <span class="mxinfo " id="T5:U421"><span class="var type1" id="S47T5U596">index</span> = <span class="mxinfo " id="T5:U423">mod(<span class="mxinfo " id="T5:U424"><span class="var type1" id="S34T5U600">l</span>-<span class="mxinfo " id="T5:U426">1</span></span>, <span class="var type1" id="S9T5U602">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U428"><span class="var type1" id="S47T5U606">index</span> == <span class="mxinfo " id="T5:U430">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">                <span class="mxinfo " id="T5:U431"><span class="var type1" id="S58T5U610">index2</span> = <span class="var type1" id="S9T5U611">N</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">            <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">                <span class="mxinfo " id="T5:U434"><span class="var type1" id="S58T5U615">index2</span> = <span class="var type1" id="S47T5U616">index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S49T5U619">s</span> = <span class="mxinfo " id="T5:U438">0</span> : 2^<span class="var type1" id="S16T5U625">crsc_v</span> - 1  <span class="comment">% s_(l+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">                <span class="mxinfo " id="T5:U440"><span class="var type1" id="S50T5U629">summ</span> = <span class="mxinfo " id="T5:U442">-<span class="mxinfo " id="T5:U443">Inf</span></span></span>;        <span class="comment">% Sum over the neighbours of s</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S59T5U635">u_p</span> = <span class="mxinfo " id="T5:U445">0</span> : 2^<span class="var type1" id="S14T5U641">crsc_k</span> - 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">                    <span class="mxinfo " id="T5:U447"><span class="var type1" id="S52T5U645">ql_u</span> = <span class="mxinfo " id="T5:U449"><span class="var type1" id="S46T9U647">mu_eq</span>(<span class="mxinfo " id="T5:U451"><span class="var type1" id="S59T5U649">u_p</span>+<span class="mxinfo " id="T5:U453">1</span></span>, <span class="var type1" id="S58T5U651">index2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">                    <span class="mxinfo " id="T5:U455"><span class="var type1" id="S60T5U654">s_p</span> = <span class="mxinfo " id="T5:U457"><span class="var type1" id="S6T3U656">neighbours_table</span>(<span class="mxinfo " id="T5:U459"><span class="var type1" id="S49T5U658">s</span>+<span class="mxinfo " id="T5:U461">1</span></span>, <span class="mxinfo " id="T5:U462"><span class="var type1" id="S59T5U661">u_p</span>+<span class="mxinfo " id="T5:U464">1</span></span>)</span></span>;  <span class="comment">% s_l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">                    <span class="mxinfo " id="T5:U465"><span class="var type1" id="S35T5U665">y</span> = <span class="mxinfo " id="T5:U467"><span class="var type1" id="S5T3U667">output_table</span>(<span class="mxinfo " id="T5:U469"><span class="var type1" id="S60T5U669">s_p</span>+<span class="mxinfo " id="T5:U471">1</span></span>, <span class="mxinfo " id="T5:U472"><span class="var type1" id="S59T5U672">u_p</span>+<span class="mxinfo " id="T5:U474">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">                    <span class="mxinfo " id="T5:U475"><span class="var type1" id="S53T5U676">gl_y</span> = <span class="mxinfo " id="T5:U477"><span class="var type1" id="S29T12U678">g1</span>(<span class="mxinfo " id="T5:U479"><span class="var type1" id="S35T5U680">y</span>+<span class="mxinfo " id="T5:U481">1</span></span>, <span class="var type1" id="S58T5U682">index2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">                    <span class="mxinfo " id="T5:U483"><span class="var type1" id="S61T5U685">F_p</span> = <span class="mxinfo " id="T5:U485"><span class="var type1" id="S44T12U687">forward_matrix</span>(<span class="mxinfo " id="T5:U487"><span class="var type1" id="S60T5U689">s_p</span>+<span class="mxinfo " id="T5:U489">1</span></span>, <span class="var type1" id="S58T5U691">index2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">                    <span class="mxinfo " id="T5:U491"><span class="var type1" id="S56T5U694">add</span> = <span class="mxinfo " id="T5:U493"><span class="mxinfo " id="T5:U494"><span class="var type1" id="S61T5U697">F_p</span> + <span class="var type1" id="S53T5U698">gl_y</span></span> + <span class="var type1" id="S52T5U699">ql_u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">                    <span class="mxinfo " id="T5:U498"><span class="var type1" id="S50T5U702">summ</span> = <span class="mxinfo " id="T5:U500">log(<span class="mxinfo " id="T5:U501"><span class="mxinfo " id="T5:U502">exp(<span class="var type1" id="S50T5U708">summ</span>)</span>+<span class="mxinfo " id="T5:U504">exp(<span class="var type1" id="S56T5U711">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">                <span class="mxinfo " id="T5:U506"><span class="mxinfo " id="T5:U507"><span class="var type1" id="S44T12U715">forward_matrix</span>(<span class="mxinfo " id="T5:U509"><span class="var type1" id="S49T5U717">s</span>+<span class="mxinfo " id="T5:U511">1</span></span>, <span class="mxinfo " id="T5:U512"><span class="var type1" id="S47T5U720">index</span>+<span class="mxinfo " id="T5:U514">1</span></span>)</span> = <span class="var type1" id="S50T5U722">summ</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">            <span class="mxinfo " id="T18:U516"><span class="mxinfo " id="T18:U517"><span class="var type1" id="S44T12U726">forward_matrix</span>(<span class="mxinfo " id="T19:U519">:</span>, <span class="mxinfo " id="T5:U520"><span class="var type1" id="S47T5U729">index</span>+<span class="mxinfo " id="T5:U522">1</span></span>)</span> = <span class="mxinfo " id="T18:U523"><span class="mxinfo " id="T18:U524"><span class="var type1" id="S44T12U733">forward_matrix</span>(<span class="mxinfo " id="T19:U526">:</span>, <span class="mxinfo " id="T5:U527"><span class="var type1" id="S47T5U736">index</span>+<span class="mxinfo " id="T5:U529">1</span></span>)</span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">                        <span class="mxinfo " id="T5:U530">max(<span class="mxinfo " id="T18:U531"><span class="var type1" id="S44T12U741">forward_matrix</span>(<span class="mxinfo " id="T19:U533">:</span>, <span class="mxinfo " id="T5:U534"><span class="var type1" id="S47T5U744">index</span>+<span class="mxinfo " id="T5:U536">1</span></span>)</span>)</span></span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">        <span class="comment">% 2.3 Extrinsic message update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="mxinfo " id="T5:U537"><span class="var type1" id="S62T5U748">index_b</span> = <span class="mxinfo " id="T5:U539">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        <span class="mxinfo " id="T5:U540"><span class="var type1" id="S63T5U752">index_f</span> = <span class="mxinfo " id="T5:U542">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U756">l</span> = <span class="mxinfo " id="T5:U544">1</span> : <span class="var type1" id="S9T5U759">N</span>                             <span class="comment">% This is a matlab index!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S51T5U762">u</span> = <span class="mxinfo " id="T5:U547">0</span> : 2^<span class="var type1" id="S14T5U768">crsc_k</span> -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">                <span class="mxinfo " id="T5:U549"><span class="var type1" id="S50T5U772">summ</span> = <span class="mxinfo " id="T5:U551">-<span class="mxinfo " id="T5:U552">Inf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S49T5U778">s</span> = <span class="mxinfo " id="T5:U554">0</span> : 2^<span class="var type1" id="S16T5U784">crsc_v</span> -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">                    <span class="mxinfo " id="T5:U556"><span class="var type1" id="S54T5U788">s_n</span> = <span class="mxinfo " id="T5:U558"><span class="var type1" id="S4T3U790">state_update_table</span>(<span class="mxinfo " id="T5:U560"><span class="var type1" id="S49T5U792">s</span>+<span class="mxinfo " id="T5:U562">1</span></span>, <span class="mxinfo " id="T5:U563"><span class="var type1" id="S51T5U795">u</span>+<span class="mxinfo " id="T5:U565">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">                    <span class="mxinfo " id="T5:U566"><span class="var type1" id="S35T5U799">y</span> = <span class="mxinfo " id="T5:U568"><span class="var type1" id="S5T3U801">output_table</span>(<span class="mxinfo " id="T5:U570"><span class="var type1" id="S49T5U803">s</span>+<span class="mxinfo " id="T5:U572">1</span></span>, <span class="mxinfo " id="T5:U573"><span class="var type1" id="S51T5U806">u</span>+<span class="mxinfo " id="T5:U575">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">                    <span class="mxinfo " id="T5:U576"><span class="var type1" id="S53T5U810">gl_y</span> = <span class="mxinfo " id="T5:U578"><span class="var type1" id="S29T12U812">g1</span>(<span class="mxinfo " id="T5:U580"><span class="var type1" id="S35T5U814">y</span>+<span class="mxinfo " id="T5:U582">1</span></span>, <span class="var type1" id="S34T5U816">l</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">                    <span class="mxinfo " id="T5:U584"><span class="var type1" id="S64T5U819">F</span> = <span class="mxinfo " id="T5:U586"><span class="var type1" id="S44T12U821">forward_matrix</span>(<span class="mxinfo " id="T5:U588"><span class="var type1" id="S49T5U823">s</span>+<span class="mxinfo " id="T5:U590">1</span></span>, <span class="var type1" id="S63T5U825">index_f</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">                    <span class="mxinfo " id="T5:U592"><span class="var type1" id="S65T5U828">B</span> = <span class="mxinfo " id="T5:U594"><span class="var type1" id="S42T12U830">backward_matrix</span>(<span class="mxinfo " id="T5:U596"><span class="var type1" id="S54T5U832">s_n</span>+<span class="mxinfo " id="T5:U598">1</span></span>, <span class="var type1" id="S62T5U834">index_b</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">                    <span class="mxinfo " id="T5:U600"><span class="var type1" id="S56T5U837">add</span> = <span class="mxinfo " id="T5:U602"><span class="mxinfo " id="T5:U603"><span class="var type1" id="S64T5U840">F</span> + <span class="var type1" id="S65T5U841">B</span></span> + <span class="var type1" id="S53T5U842">gl_y</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">                    <span class="mxinfo " id="T5:U607"><span class="var type1" id="S50T5U845">summ</span> = <span class="mxinfo " id="T5:U609">log(<span class="mxinfo " id="T5:U610"><span class="mxinfo " id="T5:U611">exp(<span class="var type1" id="S50T5U851">summ</span>)</span>+<span class="mxinfo " id="T5:U613">exp(<span class="var type1" id="S56T5U854">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">                <span class="mxinfo " id="T5:U615"><span class="mxinfo " id="T5:U616"><span class="var type1" id="S45T9U858">extrinsic_matrix</span>(<span class="mxinfo " id="T5:U618"><span class="var type1" id="S51T5U860">u</span>+<span class="mxinfo " id="T5:U620">1</span></span>, <span class="var type1" id="S34T5U862">l</span>)</span> = <span class="var type1" id="S50T5U863">summ</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="mxinfo " id="T5:U623"><span class="var type1" id="S63T5U866">index_f</span> = <span class="mxinfo " id="T5:U625"><span class="var type1" id="S63T5U868">index_f</span> + <span class="mxinfo " id="T5:U627">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">            <span class="mxinfo " id="T5:U628"><span class="var type1" id="S62T5U872">index_b</span> = <span class="mxinfo " id="T5:U630"><span class="var type1" id="S62T5U874">index_b</span> + <span class="mxinfo " id="T5:U632">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">            <span class="comment">% index_b = mod(index_b + 1, N);        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">        <span class="mxinfo " id="T9:U633"><span class="var type1" id="S40T9U878">E1</span> = <span class="var type1" id="S45T9U879">extrinsic_matrix</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">        <span class="mxinfo " id="T9:U636"><span class="var type1" id="S40T9U882">E1</span> = <span class="mxinfo " id="T9:U638">bsxfun(@minus, <span class="var type1" id="S40T9U887">E1</span>, <span class="mxinfo " id="T11:U640">max(<span class="var type1" id="S40T9U890">E1</span>)</span>)</span></span>;  <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">        <span class="comment">% 2.4 Message from the equality factor update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">        <span class="mxinfo " id="T9:U642"><span class="var type1" id="S46T9U893">mu_eq</span> = <span class="mxinfo " id="T9:U644"><span class="var type1" id="S40T9U895">E1</span> + <span class="var type1" id="S23T9U896">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="mxinfo " id="T9:U647"><span class="var type1" id="S46T9U899">mu_eq</span> = <span class="mxinfo " id="T9:U649">bsxfun(@minus, <span class="var type1" id="S46T9U904">mu_eq</span>, <span class="mxinfo " id="T11:U651">max(<span class="var type1" id="S46T9U907">mu_eq</span>)</span>)</span></span>;  <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">        <span class="comment">% 3 BCJR ALGORITHM ON THE LOWER CODE</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="comment">% 3.0 BCJR matrices initialization </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">        <span class="mxinfo " id="T12:U653"><span class="var type1" id="S42T12U910">backward_matrix</span> = <span class="mxinfo " id="T12:U655">-<span class="mxinfo " id="T12:U656">Inf(<span class="mxinfo " id="T10:U657">2^<span class="var type1" id="S16T5U916">crsc_v</span></span>, <span class="var type1" id="S9T5U917">N</span>)</span></span></span>;   <span class="comment">% Row: state  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">        <span class="mxinfo " id="T12:U660"><span class="var type1" id="S44T12U920">forward_matrix</span> = <span class="mxinfo " id="T12:U662">-<span class="mxinfo " id="T12:U663">Inf(<span class="mxinfo " id="T5:U664">2^<span class="var type1" id="S16T5U926">crsc_v</span></span>, <span class="var type1" id="S9T5U927">N</span>)</span></span></span>;    <span class="comment">% Row: state  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">        <span class="mxinfo " id="T9:U667"><span class="var type1" id="S45T9U930">extrinsic_matrix</span> = <span class="mxinfo " id="T9:U669">-<span class="mxinfo " id="T9:U670">Inf(<span class="mxinfo " id="T5:U671">2^<span class="var type1" id="S14T5U936">crsc_k</span></span>, <span class="var type1" id="S9T5U937">N</span>)</span></span></span>;  <span class="comment">% Row: input  | Column: step l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">        <span class="comment">% 3.1 Backward message update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">        <span class="mxinfo " id="T5:U674"><span class="mxinfo " id="T5:U675"><span class="var type1" id="S42T12U941">backward_matrix</span>(<span class="mxinfo " id="T5:U677">1</span>,<span class="mxinfo " id="T5:U678">end</span>)</span> = <span class="mxinfo " id="T5:U679">0</span></span>; <span class="comment">% Starting with B_(N-1)(s_0) = 0 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U948">l</span> = <span class="mxinfo " id="T5:U681"><span class="mxinfo " id="T5:U682"><span class="mxinfo " id="T5:U683">2</span>*<span class="var type1" id="S9T5U954">N</span></span>-<span class="mxinfo " id="T5:U685">1</span></span> : <span class="mxinfo " id="T5:U686">-1</span> : <span class="mxinfo " id="T5:U687">1</span>      <span class="comment">% This is a matlab matrix index</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">            <span class="mxinfo " id="T5:U688"><span class="var type1" id="S47T5U961">index</span> = <span class="mxinfo " id="T5:U690">mod(<span class="var type1" id="S34T5U964">l</span>,<span class="var type1" id="S9T5U965">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S49T5U968">s</span> = <span class="mxinfo " id="T5:U694">0</span> : 2^<span class="var type1" id="S16T5U974">crsc_v</span> - 1  <span class="comment">% s_l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">                <span class="mxinfo " id="T5:U696"><span class="var type1" id="S50T5U978">summ</span> = <span class="mxinfo " id="T5:U698">-<span class="mxinfo " id="T5:U699">Inf</span></span></span>;       <span class="comment">% Sum over u </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S51T5U984">u</span> = <span class="mxinfo " id="T5:U701">0</span> : 2^<span class="var type1" id="S14T5U990">crsc_k</span> - 1 </span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">                    <span class="mxinfo " id="T5:U703"><span class="var type1" id="S52T5U994">ql_u</span> = <span class="mxinfo " id="T5:U705"><span class="var type1" id="S46T9U996">mu_eq</span>(<span class="mxinfo " id="T5:U707"><span class="mxinfo " id="T5:U708"><span class="var type1" id="S11T6U999">p_input_table</span>(<span class="mxinfo " id="T5:U710"><span class="var type1" id="S51T5U1001">u</span>+<span class="mxinfo " id="T5:U712">1</span></span>, <span class="mxinfo " id="T5:U713"><span class="var type1" id="S47T5U1004">index</span>+<span class="mxinfo " id="T5:U715">1</span></span>)</span>+<span class="mxinfo " id="T5:U716">1</span></span>, <span class="mxinfo " id="T5:U717"><span class="mxinfo " id="T5:U718"><span class="var type1" id="S12T6U1009">p_step_table</span>(<span class="mxinfo " id="T5:U720"><span class="var type1" id="S51T5U1011">u</span>+<span class="mxinfo " id="T5:U722">1</span></span>,<span class="mxinfo " id="T5:U723"><span class="var type1" id="S47T5U1014">index</span>+<span class="mxinfo " id="T5:U725">1</span></span>)</span>+<span class="mxinfo " id="T5:U726">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">                    <span class="mxinfo " id="T5:U727"><span class="var type1" id="S35T5U1019">y</span> = <span class="mxinfo " id="T5:U729"><span class="var type1" id="S5T3U1021">output_table</span>(<span class="mxinfo " id="T5:U731"><span class="var type1" id="S49T5U1023">s</span>+<span class="mxinfo " id="T5:U733">1</span></span>, <span class="mxinfo " id="T5:U734"><span class="var type1" id="S51T5U1026">u</span>+<span class="mxinfo " id="T5:U736">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">                    <span class="mxinfo " id="T5:U737"><span class="var type1" id="S53T5U1030">gl_y</span> = <span class="mxinfo " id="T5:U739"><span class="var type1" id="S30T12U1032">g2</span>(<span class="mxinfo " id="T5:U741"><span class="var type1" id="S35T5U1034">y</span>+<span class="mxinfo " id="T5:U743">1</span></span>, <span class="mxinfo " id="T5:U744"><span class="var type1" id="S47T5U1037">index</span>+<span class="mxinfo " id="T5:U746">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">                    <span class="mxinfo " id="T5:U747"><span class="var type1" id="S54T5U1041">s_n</span>  = <span class="mxinfo " id="T5:U749"><span class="var type1" id="S4T3U1043">state_update_table</span>(<span class="mxinfo " id="T5:U751"><span class="var type1" id="S49T5U1045">s</span>+<span class="mxinfo " id="T5:U753">1</span></span>, <span class="mxinfo " id="T5:U754"><span class="var type1" id="S51T5U1048">u</span>+<span class="mxinfo " id="T5:U756">1</span></span>)</span></span>;    <span class="comment">% s_(l+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">                    <span class="mxinfo " id="T5:U757"><span class="var type1" id="S55T5U1052">B_n</span> = <span class="mxinfo " id="T5:U759"><span class="var type1" id="S42T12U1054">backward_matrix</span>(<span class="mxinfo " id="T5:U761"><span class="var type1" id="S54T5U1056">s_n</span>+<span class="mxinfo " id="T5:U763">1</span></span>, <span class="mxinfo " id="T5:U764"><span class="var type1" id="S47T5U1059">index</span>+<span class="mxinfo " id="T5:U766">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">                    <span class="mxinfo " id="T5:U767"><span class="var type1" id="S56T5U1063">add</span> = <span class="mxinfo " id="T5:U769"><span class="mxinfo " id="T5:U770"><span class="var type1" id="S55T5U1066">B_n</span> + <span class="var type1" id="S53T5U1067">gl_y</span></span> + <span class="var type1" id="S52T5U1068">ql_u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">                    <span class="mxinfo " id="T5:U774"><span class="var type1" id="S50T5U1071">summ</span> = <span class="mxinfo " id="T5:U776">log(<span class="mxinfo " id="T5:U777"><span class="mxinfo " id="T5:U778">exp(<span class="var type1" id="S50T5U1077">summ</span>)</span>+<span class="mxinfo " id="T5:U780">exp(<span class="var type1" id="S56T5U1080">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">                <span class="keyword">if</span> <span class="mxinfo " id="T8:U782"><span class="var type1" id="S47T5U1084">index</span> == <span class="mxinfo " id="T5:U784">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">                    <span class="mxinfo " id="T5:U785"><span class="var type1" id="S58T5U1088">index2</span> = <span class="var type1" id="S9T5U1089">N</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">                    <span class="mxinfo " id="T5:U788"><span class="var type1" id="S58T5U1093">index2</span> = <span class="var type1" id="S47T5U1094">index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">                <span class="mxinfo " id="T5:U791"><span class="mxinfo " id="T5:U792"><span class="var type1" id="S42T12U1098">backward_matrix</span>(<span class="mxinfo " id="T5:U794"><span class="var type1" id="S49T5U1100">s</span>+<span class="mxinfo " id="T5:U796">1</span></span>, <span class="var type1" id="S58T5U1102">index2</span>)</span> = <span class="var type1" id="S50T5U1103">summ</span></span>;           </span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">            <span class="mxinfo " id="T18:U799"><span class="mxinfo " id="T18:U800"><span class="var type1" id="S42T12U1107">backward_matrix</span>(<span class="mxinfo " id="T19:U802">:</span>, <span class="var type1" id="S58T5U1109">index2</span>)</span> = <span class="mxinfo " id="T18:U804"><span class="mxinfo " id="T18:U805"><span class="var type1" id="S42T12U1112">backward_matrix</span>(<span class="mxinfo " id="T19:U807">:</span>, <span class="var type1" id="S58T5U1114">index2</span>)</span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">                         - <span class="mxinfo " id="T5:U809">max(<span class="mxinfo " id="T18:U810"><span class="var type1" id="S42T12U1118">backward_matrix</span>(<span class="mxinfo " id="T19:U812">:</span>, <span class="var type1" id="S58T5U1120">index2</span>)</span>)</span></span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">        <span class="comment">% 3.2 Forward messages update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">        <span class="mxinfo " id="T5:U814"><span class="mxinfo " id="T5:U815"><span class="var type1" id="S44T12U1124">forward_matrix</span>(<span class="mxinfo " id="T5:U817">1</span>,<span class="mxinfo " id="T5:U818">1</span>)</span> = <span class="mxinfo " id="T5:U819">0</span></span>; <span class="comment">% Starting with F_0 (s_0) = 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U1130">l</span> = <span class="mxinfo " id="T5:U821">2</span>:<span class="mxinfo " id="T5:U822"><span class="mxinfo " id="T5:U823">2</span>*<span class="var type1" id="S9T5U1135">N</span></span>            <span class="comment">% This is a matlab matrix index</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">            <span class="mxinfo " id="T5:U825"><span class="var type1" id="S47T5U1138">index</span> = <span class="mxinfo " id="T5:U827">mod(<span class="mxinfo " id="T5:U828"><span class="var type1" id="S34T5U1142">l</span>-<span class="mxinfo " id="T5:U830">1</span></span>, <span class="var type1" id="S9T5U1144">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U832"><span class="var type1" id="S47T5U1148">index</span> == <span class="mxinfo " id="T5:U834">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">                <span class="mxinfo " id="T5:U835"><span class="var type1" id="S58T5U1152">index2</span> = <span class="var type1" id="S9T5U1153">N</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">            <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">                <span class="mxinfo " id="T5:U838"><span class="var type1" id="S58T5U1157">index2</span> = <span class="var type1" id="S47T5U1158">index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S49T5U1161">s</span> = <span class="mxinfo " id="T5:U842">0</span> : 2^<span class="var type1" id="S16T5U1167">crsc_v</span> - 1  <span class="comment">% s_(l+1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">                <span class="mxinfo " id="T5:U844"><span class="var type1" id="S50T5U1171">summ</span> = <span class="mxinfo " id="T5:U846">-<span class="mxinfo " id="T5:U847">Inf</span></span></span>;        <span class="comment">% Sum over the neighbours of s</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S59T5U1177">u_p</span> = <span class="mxinfo " id="T5:U849">0</span> : 2^<span class="var type1" id="S14T5U1183">crsc_k</span> - 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">                    <span class="mxinfo " id="T5:U851"><span class="var type1" id="S52T5U1187">ql_u</span> = <span class="mxinfo " id="T5:U853"><span class="var type1" id="S46T9U1189">mu_eq</span>(<span class="mxinfo " id="T5:U855"><span class="mxinfo " id="T5:U856"><span class="var type1" id="S11T6U1192">p_input_table</span>(<span class="mxinfo " id="T5:U858"><span class="var type1" id="S59T5U1194">u_p</span>+<span class="mxinfo " id="T5:U860">1</span></span>,<span class="var type1" id="S58T5U1196">index2</span>)</span>+<span class="mxinfo " id="T5:U862">1</span></span>, <span class="mxinfo " id="T5:U863"><span class="mxinfo " id="T5:U864"><span class="var type1" id="S12T6U1200">p_step_table</span>(<span class="mxinfo " id="T5:U866"><span class="var type1" id="S59T5U1202">u_p</span>+<span class="mxinfo " id="T5:U868">1</span></span>,<span class="var type1" id="S58T5U1204">index2</span>)</span>+<span class="mxinfo " id="T5:U870">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">                    <span class="mxinfo " id="T5:U871"><span class="var type1" id="S60T5U1208">s_p</span> = <span class="mxinfo " id="T5:U873"><span class="var type1" id="S6T3U1210">neighbours_table</span>(<span class="mxinfo " id="T5:U875"><span class="var type1" id="S49T5U1212">s</span>+<span class="mxinfo " id="T5:U877">1</span></span>, <span class="mxinfo " id="T5:U878"><span class="var type1" id="S59T5U1215">u_p</span>+<span class="mxinfo " id="T5:U880">1</span></span>)</span></span>;  <span class="comment">% s_l</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">                    <span class="mxinfo " id="T5:U881"><span class="var type1" id="S35T5U1219">y</span> = <span class="mxinfo " id="T5:U883"><span class="var type1" id="S5T3U1221">output_table</span>(<span class="mxinfo " id="T5:U885"><span class="var type1" id="S60T5U1223">s_p</span>+<span class="mxinfo " id="T5:U887">1</span></span>, <span class="mxinfo " id="T5:U888"><span class="var type1" id="S59T5U1226">u_p</span>+<span class="mxinfo " id="T5:U890">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">                    <span class="mxinfo " id="T5:U891"><span class="var type1" id="S53T5U1230">gl_y</span> = <span class="mxinfo " id="T5:U893"><span class="var type1" id="S30T12U1232">g2</span>(<span class="mxinfo " id="T5:U895"><span class="var type1" id="S35T5U1234">y</span>+<span class="mxinfo " id="T5:U897">1</span></span>, <span class="var type1" id="S58T5U1236">index2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">                    <span class="mxinfo " id="T5:U899"><span class="var type1" id="S61T5U1239">F_p</span> = <span class="mxinfo " id="T5:U901"><span class="var type1" id="S44T12U1241">forward_matrix</span>(<span class="mxinfo " id="T5:U903"><span class="var type1" id="S60T5U1243">s_p</span>+<span class="mxinfo " id="T5:U905">1</span></span>, <span class="var type1" id="S58T5U1245">index2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">                    <span class="mxinfo " id="T5:U907"><span class="var type1" id="S56T5U1248">add</span> = <span class="mxinfo " id="T5:U909"><span class="mxinfo " id="T5:U910"><span class="var type1" id="S61T5U1251">F_p</span> + <span class="var type1" id="S53T5U1252">gl_y</span></span> + <span class="var type1" id="S52T5U1253">ql_u</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">                    <span class="mxinfo " id="T5:U914"><span class="var type1" id="S50T5U1256">summ</span> = <span class="mxinfo " id="T5:U916">log(<span class="mxinfo " id="T5:U917"><span class="mxinfo " id="T5:U918">exp(<span class="var type1" id="S50T5U1262">summ</span>)</span>+<span class="mxinfo " id="T5:U920">exp(<span class="var type1" id="S56T5U1265">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">                <span class="mxinfo " id="T5:U922"><span class="mxinfo " id="T5:U923"><span class="var type1" id="S44T12U1269">forward_matrix</span>(<span class="mxinfo " id="T5:U925"><span class="var type1" id="S49T5U1271">s</span>+<span class="mxinfo " id="T5:U927">1</span></span>, <span class="mxinfo " id="T5:U928"><span class="var type1" id="S47T5U1274">index</span>+<span class="mxinfo " id="T5:U930">1</span></span>)</span> = <span class="var type1" id="S50T5U1276">summ</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">            <span class="mxinfo " id="T18:U932"><span class="mxinfo " id="T18:U933"><span class="var type1" id="S44T12U1280">forward_matrix</span>(<span class="mxinfo " id="T19:U935">:</span>, <span class="mxinfo " id="T5:U936"><span class="var type1" id="S47T5U1283">index</span>+<span class="mxinfo " id="T5:U938">1</span></span>)</span> = <span class="mxinfo " id="T18:U939"><span class="mxinfo " id="T18:U940"><span class="var type1" id="S44T12U1287">forward_matrix</span>(<span class="mxinfo " id="T19:U942">:</span>, <span class="mxinfo " id="T5:U943"><span class="var type1" id="S47T5U1290">index</span>+<span class="mxinfo " id="T5:U945">1</span></span>)</span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">                        <span class="mxinfo " id="T5:U946">max(<span class="mxinfo " id="T18:U947"><span class="var type1" id="S44T12U1295">forward_matrix</span>(<span class="mxinfo " id="T19:U949">:</span>, <span class="mxinfo " id="T5:U950"><span class="var type1" id="S47T5U1298">index</span>+<span class="mxinfo " id="T5:U952">1</span></span>)</span>)</span></span></span>; <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">        <span class="comment">% 3.3 Extrinsic message update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">        <span class="mxinfo " id="T5:U953"><span class="var type1" id="S62T5U1302">index_b</span> = <span class="mxinfo " id="T5:U955">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">        <span class="mxinfo " id="T5:U956"><span class="var type1" id="S63T5U1306">index_f</span> = <span class="mxinfo " id="T5:U958">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S34T5U1310">l</span> = <span class="mxinfo " id="T5:U960">1</span> : <span class="var type1" id="S9T5U1313">N</span>                             <span class="comment">% This is a matlab index!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S51T5U1316">u</span> = <span class="mxinfo " id="T5:U963">0</span> : 2^<span class="var type1" id="S14T5U1322">crsc_k</span> -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">                <span class="mxinfo " id="T5:U965"><span class="var type1" id="S50T5U1326">summ</span> = <span class="mxinfo " id="T5:U967">-<span class="mxinfo " id="T5:U968">Inf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S49T5U1332">s</span> = <span class="mxinfo " id="T5:U970">0</span> : 2^<span class="var type1" id="S16T5U1338">crsc_v</span> -1</span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">                    <span class="mxinfo " id="T5:U972"><span class="var type1" id="S54T5U1342">s_n</span> = <span class="mxinfo " id="T5:U974"><span class="var type1" id="S4T3U1344">state_update_table</span>(<span class="mxinfo " id="T5:U976"><span class="var type1" id="S49T5U1346">s</span>+<span class="mxinfo " id="T5:U978">1</span></span>, <span class="mxinfo " id="T5:U979"><span class="var type1" id="S51T5U1349">u</span>+<span class="mxinfo " id="T5:U981">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">                    <span class="mxinfo " id="T5:U982"><span class="var type1" id="S35T5U1353">y</span> = <span class="mxinfo " id="T5:U984"><span class="var type1" id="S5T3U1355">output_table</span>(<span class="mxinfo " id="T5:U986"><span class="var type1" id="S49T5U1357">s</span>+<span class="mxinfo " id="T5:U988">1</span></span>, <span class="mxinfo " id="T5:U989"><span class="var type1" id="S51T5U1360">u</span>+<span class="mxinfo " id="T5:U991">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">                    <span class="mxinfo " id="T5:U992"><span class="var type1" id="S53T5U1364">gl_y</span> = <span class="mxinfo " id="T5:U994"><span class="var type1" id="S30T12U1366">g2</span>(<span class="mxinfo " id="T5:U996"><span class="var type1" id="S35T5U1368">y</span>+<span class="mxinfo " id="T5:U998">1</span></span>, <span class="var type1" id="S34T5U1370">l</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">                    <span class="mxinfo " id="T5:U1000"><span class="var type1" id="S64T5U1373">F</span> = <span class="mxinfo " id="T5:U1002"><span class="var type1" id="S44T12U1375">forward_matrix</span>(<span class="mxinfo " id="T5:U1004"><span class="var type1" id="S49T5U1377">s</span>+<span class="mxinfo " id="T5:U1006">1</span></span>, <span class="var type1" id="S63T5U1379">index_f</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">                    <span class="mxinfo " id="T5:U1008"><span class="var type1" id="S65T5U1382">B</span> = <span class="mxinfo " id="T5:U1010"><span class="var type1" id="S42T12U1384">backward_matrix</span>(<span class="mxinfo " id="T5:U1012"><span class="var type1" id="S54T5U1386">s_n</span>+<span class="mxinfo " id="T5:U1014">1</span></span>, <span class="var type1" id="S62T5U1388">index_b</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">                    <span class="mxinfo " id="T5:U1016"><span class="var type1" id="S56T5U1391">add</span> = <span class="mxinfo " id="T5:U1018"><span class="mxinfo " id="T5:U1019"><span class="var type1" id="S64T5U1394">F</span> + <span class="var type1" id="S65T5U1395">B</span></span> + <span class="var type1" id="S53T5U1396">gl_y</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">                    <span class="comment">% TO IMPLEMENT: PIECEWISE CONSTANT APPROXIMATION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">                    <span class="mxinfo " id="T5:U1023"><span class="var type1" id="S50T5U1399">summ</span> = <span class="mxinfo " id="T5:U1025">log(<span class="mxinfo " id="T5:U1026"><span class="mxinfo " id="T5:U1027">exp(<span class="var type1" id="S50T5U1405">summ</span>)</span>+<span class="mxinfo " id="T5:U1029">exp(<span class="var type1" id="S56T5U1408">add</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">                <span class="comment">%extrinsic_matrix(u+1, l) = summ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">                <span class="mxinfo " id="T5:U1031"><span class="mxinfo " id="T5:U1032"><span class="var type1" id="S45T9U1412">extrinsic_matrix</span>(<span class="mxinfo " id="T5:U1034"><span class="mxinfo " id="T5:U1035"><span class="var type1" id="S11T6U1415">p_input_table</span>(<span class="mxinfo " id="T5:U1037"><span class="var type1" id="S51T5U1417">u</span>+<span class="mxinfo " id="T5:U1039">1</span></span>,<span class="var type1" id="S34T5U1419">l</span>)</span>+<span class="mxinfo " id="T5:U1041">1</span></span>, <span class="mxinfo " id="T5:U1042"><span class="mxinfo " id="T5:U1043"><span class="var type1" id="S12T6U1423">p_step_table</span>(<span class="mxinfo " id="T5:U1045"><span class="var type1" id="S51T5U1425">u</span>+<span class="mxinfo " id="T5:U1047">1</span></span>,<span class="var type1" id="S34T5U1427">l</span>)</span>+<span class="mxinfo " id="T5:U1049">1</span></span>)</span> = <span class="var type1" id="S50T5U1429">summ</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">            <span class="mxinfo " id="T5:U1051"><span class="var type1" id="S63T5U1432">index_f</span> = <span class="mxinfo " id="T5:U1053"><span class="var type1" id="S63T5U1434">index_f</span> + <span class="mxinfo " id="T5:U1055">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">            <span class="mxinfo " id="T5:U1056"><span class="var type1" id="S62T5U1438">index_b</span> = <span class="mxinfo " id="T5:U1058"><span class="var type1" id="S62T5U1440">index_b</span> + <span class="mxinfo " id="T5:U1060">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">            <span class="comment">% index_b = mod(index_b + 1, N);        </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">        <span class="mxinfo " id="T9:U1061"><span class="var type1" id="S39T9U1444">E2</span> = <span class="var type1" id="S45T9U1445">extrinsic_matrix</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">        <span class="mxinfo " id="T9:U1064"><span class="var type1" id="S39T9U1448">E2</span> = <span class="mxinfo " id="T9:U1066">bsxfun(@minus, <span class="var type1" id="S39T9U1453">E2</span>, <span class="mxinfo " id="T11:U1068">max(<span class="var type1" id="S39T9U1456">E2</span>)</span>)</span></span>;   <span class="comment">% Normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">    <span class="comment">% Maximum a posteriori estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">    [ <span class="mxinfo " id="T5:U1070">~</span> , <span class="var type1" id="S66T11U1461">u_hat_num</span> ] = max(<span class="mxinfo " id="T9:U1072"><span class="mxinfo " id="T9:U1073"><span class="var type1" id="S39T9U1466">E2</span>+<span class="var type1" id="S23T9U1467">q</span></span>+<span class="var type1" id="S40T9U1468">E1</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">    <span class="mxinfo " id="T1:U1077"><span class="var type1" id="S2T1U1471">u_hat</span> = <span class="mxinfo " id="T1:U1079">zeros(<span class="mxinfo " id="T5:U1080"><span class="mxinfo " id="T5:U1081">length(<span class="var type1" id="S66T11U1477">u_hat_num</span>)</span> * <span class="var type1" id="S14T5U1478">crsc_k</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">    <span class="comment">%num2input = @(i) mod(fix(i./(2.^(crsc_k-1:-1:0)).'),2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S21T5U1482">i</span> = <span class="mxinfo " id="T5:U1085">0</span> : <span class="mxinfo " id="T5:U1086"><span class="mxinfo " id="T5:U1087">length(<span class="var type1" id="S66T11U1488">u_hat_num</span>)</span>-<span class="mxinfo " id="T5:U1089">1</span></span>         <span class="comment">% From u_hat_num to u_hat</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">       <span class="comment">%u_hat(crsc_k*i+1:crsc_k*i+crsc_k) = num2input(u_hat_num(i+1)-1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">       <span class="mxinfo " id="T5:U1090"><span class="var type1" id="S68T5U1492">u_hat_num_i</span> = <span class="mxinfo " id="T5:U1092"><span class="mxinfo " id="T5:U1093"><span class="var type1" id="S66T11U1495">u_hat_num</span>(<span class="mxinfo " id="T5:U1095"><span class="var type1" id="S21T5U1497">i</span>+<span class="mxinfo " id="T5:U1097">1</span></span>)</span>-<span class="mxinfo " id="T5:U1098">1</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">       <span class="mxinfo " id="T5:U1099"><span class="mxinfo " id="T5:U1100"><span class="var type1" id="S2T1U1503">u_hat</span>(<span class="mxinfo " id="T5:U1102"><span class="mxinfo " id="T5:U1103"><span class="var type1" id="S14T5U1506">crsc_k</span>*<span class="var type1" id="S21T5U1507">i</span></span>+<span class="mxinfo " id="T5:U1106">2</span></span>)</span> = <span class="mxinfo " id="T5:U1107">mod(<span class="var type1" id="S68T5U1511">u_hat_num_i</span>,<span class="mxinfo " id="T5:U1109">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">       <span class="mxinfo " id="T5:U1110"><span class="mxinfo " id="T5:U1111"><span class="var type1" id="S2T1U1516">u_hat</span>(<span class="mxinfo " id="T5:U1113"><span class="mxinfo " id="T5:U1114"><span class="var type1" id="S14T5U1519">crsc_k</span>*<span class="var type1" id="S21T5U1520">i</span></span>+<span class="mxinfo " id="T5:U1117">1</span></span>)</span> = <span class="mxinfo " id="T5:U1118">mod(<span class="mxinfo " id="T5:U1119">fix(<span class="mxinfo " id="T5:U1120"><span class="var type1" id="S68T5U1527">u_hat_num_i</span>/<span class="mxinfo " id="T5:U1122">2</span></span>)</span>,<span class="mxinfo " id="T5:U1123">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"></span></span>
</pre>
